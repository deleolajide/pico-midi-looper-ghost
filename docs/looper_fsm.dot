digraph looper_fsm {
    /* -------- common style -------- */
    node [shape=circle, fixedsize=true, width=1.4, height=1.4,
          fontname="Helvetica", style=filled, fillcolor=lightgray, fontsize=14];
    edge [fontname="Helvetica", fontsize=13];

    /* -------- states -------- */
    Startup   [shape=point, width=0.1, label=""];
    Waiting   [label="WAITING"];
    Playing   [label="PLAYING"];
    Recording [label="RECORDING"];
    Switching [label="TRACK\nSWITCH"];
    TapTempo  [label="TAP\nTEMPO"];

    /* -------- system events -------- */
    Startup  -> Waiting   [label="Power-on"];
    Waiting  -> Playing   [label="BLE connect"];
    Playing  -> Waiting   [label="BLE disconnect"];
    Recording-> Waiting   [label="BLE disconnect"];
    TapTempo -> Waiting   [label="BLE disconnect"];

    /* -------- looper button events -------- */
    Playing   -> Recording [label="Short press"];
    Recording -> Playing   [label="2-bar done"];
    Playing   -> Switching [label="Long press"];
    Switching -> Playing   [label="Release"];

    /* -------- tap-tempo mode switch -------- */
    Playing  -> TapTempo [label="Very-long press\n(≥ 2 s)"];
    TapTempo -> Playing  [label="Long-press release\n(≥ 0.5 s)"];
}
